<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Add Product with Editable Variants Table</title>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
</head>
<body x-data="productData()">
  <include src="./partials/table-04.html"></include>
  <div class="container mx-auto p-6">
    <h2 class="text-2xl font-bold mb-6">Add Product with Variants</h2>
    <form @submit.prevent="saveProduct">
      <!-- Product Title and ID -->
      <div class="mb-6">
        <label class="block text-sm font-medium">Product Title:</label>
        <input
          type="text"
          class="w-full p-2 border rounded"
          x-model="product.title"
          required
        />
      </div>

      <div class="mb-6">
        <label class="block text-sm font-medium">Product ID:</label>
        <input
          type="text"
          class="w-full p-2 border rounded"
          x-model="product.id"
          required
        />
      </div>

      <!-- Product Description -->
      <div class="mb-6">
        <label class="block text-sm font-medium">Description:</label>
        <textarea
          class="w-full p-2 border rounded"
          x-model="product.description"
          required
        ></textarea>
      </div>

      <!-- Variants Table -->
      <div class="mb-6">
        <h3 class="text-lg font-bold">Product Variants</h3>
        <table class="w-full border-collapse border">
          <thead>
            <tr>
              <th class="border p-2">Color</th>
              <th class="border p-2">Size</th>
              <th class="border p-2">Material</th>
              <th class="border p-2">Images</th>
              <th class="border p-2">No. of Items</th>
              <th class="border p-2">Price</th>
              <th class="border p-2">Discount</th>
              <th class="border p-2">Action</th>
            </tr>
          </thead>
          <tbody>
            <template x-for="(variant, index) in product.variants" :key="index">
              <tr>
                <!-- Color -->
                <td class="border p-2">
                  <input
                    type="text"
                    class="w-full border rounded"
                    x-model="variant.color"
                    placeholder="Select/Type Color"
                  />
                </td>

                <!-- Size -->
                <td class="border p-2">
                  <input
                    type="text"
                    class="w-full border rounded"
                    x-model="variant.size"
                    placeholder="Select/Type Size"
                  />
                </td>

                <!-- Material -->
                <td class="border p-2">
                  <input
                    type="text"
                    class="w-full border rounded"
                    x-model="variant.material"
                    placeholder="Select/Type Material"
                  />
                </td>

                <!-- Images -->
                <td class="border p-2">
                  <div class="flex items-center justify-center">
                    <input
                      type="file"
                      accept="image/*"
                      class="hidden"
                      :id="'file-' + index"
                      @change="handleImageChange($event, index)"
                    />
                    <button
                      class="bg-blue-500 text-white rounded p-2"
                      @click="document.getElementById('file-' + index).click()"
                    >
                      Add Image
                    </button>
                    <div class="flex ml-4">
                      <template x-for="(image, imgIndex) in variant.images" :key="imgIndex">
                        <img
                          :src="image"
                          class="w-8 h-8 rounded mr-2"
                          alt="Variant Image"
                        />
                      </template>
                    </div>
                  </div>
                </td>

                <!-- No. of Items -->
                <td class="border p-2">
                  <div class="flex items-center">
                    <button
                      type="button"
                      class="bg-green-500 text-white rounded-full p-1"
                      @click="increaseItems(index)"
                    >
                      +
                    </button>
                    <input
                      type="number"
                      class="w-16 text-center border rounded mx-2"
                      x-model="variant.numItems"
                    />
                    <button
                      type="button"
                      class="bg-red-500 text-white rounded-full p-1"
                      @click="decreaseItems(index)"
                    >
                      -
                    </button>
                  </div>
                </td>

                <!-- Price -->
                <td class="border p-2">
                  <input
                    type="number"
                    step="0.01"
                    class="w-full border rounded"
                    x-model="variant.price"
                  />
                </td>

                <!-- Discount -->
                <td class="border p-2">
                  <input
                    type="number"
                    step="0.1"
                    class="w-full border rounded"
                    x-model="variant.discount"
                  />
                </td>

                <!-- Action -->
                <td class="border p-2 flex gap-2">
                  <!-- Save Button -->
                  <button
                    type="button"
                    class="bg-green-600 text-white rounded p-2"
                    @click="saveRow(index)"
                  >
                    Save
                  </button>

                  <!-- Delete Button -->
                  <button
                    type="button"
                    class="bg-red-500 text-white rounded p-2"
                    @click="deleteRow(index)"
                  >
                    Delete
                  </button>
                </td>
              </tr>
            </template>
          </tbody>
        </table>

        <!-- Button to Add a New Row -->
        <button
          type="button"
          class="bg-green-500 text-white p-2 rounded mt-4"
          @click="addNewVariant"
        >
          Add New Row
        </button>
      </div>

      <!-- Product Details Card -->
      <div class="mt-6">
        <h3 class="text-lg font-bold">Product Details:</h3>
        <template x-for="(variant, index) in product.variants" :key="index">
          <div class="border rounded p-4 mb-4">
            <div>
              <strong>Color:</strong> <span x-text="variant.color"></span>
            </div>
            <div>
              <strong>Size:</strong> <span x-text="variant.size"></span>
            </div>
            <div>
              <strong>Material:</strong> <span x-text="variant.material"></span>
            </div>
            <div>
              <strong>No. of Items:</strong> <span x-text="variant.numItems"></span>
            </div>
            <div>
              <strong>Price:</strong> $<span x-text="variant.price.toFixed(2)"></span>
            </div>
            <div>
              <strong>Discount:</strong> <span x-text="variant.discount.toFixed(1)"></span>%
            </div>
            <div>
              <strong>Images:</strong>
              <div class="flex">
                <template x-for="(image, imgIndex) in variant.images" :key="imgIndex">
                  <img
                    :src="image"
                    class="w-8 h-8 rounded mr-2"
                    alt="Variant Image"
                  />
                </template>
              </div>
            </div>
          </div>
        </template>
      </div>
    </form>
  </div>

  <script>
    function productData() {
      return {
        product: {
          title: '',
          id: '',
          description: '',
          variants: [
            {
              color: '',
              size: '',
              material: '',
              images: [],
              numItems: 1,
              price: 0,
              discount: 0,
            },
          ],
        },

        addNewVariant() {
          this.product.variants.push({
            color: '',
            size: '',
            material: '',
            images: [],
            numItems: 1,
            price: 0,
            discount: 0,
          });
        },

        handleImageChange(event, index) {
          const files = event.target.files;
          const reader = new FileReader();

          reader.onload = (e) => {
            const imageUrl = e.target.result;
            this.product.variants[index].images.push(imageUrl);
          };

          if (files.length > 0) {
            reader.readAsDataURL(files[0]);
          }
        },

        increaseItems(index) {
          this.product.variants[index].numItems++;
        },

        decreaseItems(index) {
          if (this.product.variants[index].numItems > 0) {
            this.product.variants[index].numItems--;
          }
        },

        saveRow(index) {
          console.log(`Row ${index} saved:`, this.product.variants[index]);
        },

        deleteRow(index) {
          this.product.variants.splice(index, 1);
           // Ensure at least one row exists
        },

        saveProduct() {
          console.log('Product Saved:', this.product);
        },
      };
    }
  </script>
</body>
